<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Hoare3</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/rip.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Reasoning about Interactive Programs</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Hoare3</h1>


<div class="doc">
<a id="lab306"></a><h3 class="section">Reasoning About Imp programs</h3>

<div class="paragraph"> </div>

 We saw that we can use the equational theory of the monad laws, along with
  some monad-specific properties to prove program transformations.

<div class="paragraph"> </div>

  What if we want to prove other things about our programs?

</div>

<div class="doc">
<a id="lab307"></a><h3 class="section">Generalizing <span class="inlinecode"><span class="id" title="var">EqM</span></span></h3>

<div class="paragraph"> </div>

 Recall  <span class="inlinecode"><span class="id" title="var">eqM</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">A</span>,</span> <span class="inlinecode"><span class="id" title="var">M</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">M</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span></span> , in particular our insistance
   that bind be <span class="inlinecode"><span class="id" title="var">Proper</span></span>.
  
<div class="paragraph"> </div>

 Idea: generalize to a binary, heterogeneous relation:
      <span class="inlinecode"><span class="id" title="var">eqMR</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">B</span>,</span> <span class="inlinecode"><span class="id" title="var">M</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">M</span></span> <span class="inlinecode"><span class="id" title="var">B</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>
  
<div class="paragraph"> </div>

<a id="lab308"></a><h3 class="section">More General Typeclass</h3>

<div class="paragraph"> </div>

<br/>
<span class="inlinecode"><span class="id" title="keyword">Definition</span> <span class="id" title="var">relationH</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> := <span class="id" title="var">A</span> → <span class="id" title="var">B</span> → <span class="id" title="keyword">Prop</span>
</span>
</div>
<div class="code">

&nbsp;&nbsp;<span class="id" title="keyword">Class</span> <span class="id" title="var">EqMR</span> (<span class="id" title="var">M</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=  {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqMR</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">relationH</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>), <span class="id" title="var">relationH</span> (<span class="id" title="var">M</span> <span class="id" title="var">A</span>) (<span class="id" title="var">M</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;}.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
Assuming <span class="inlinecode"><span class="id" title="var">R</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">relationH</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">B</span></span> 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> &quot;t<sub>1</sub> ≈[ R ] t<sub>2</sub>" := (<span class="id" title="var">eutt</span> <span class="id" title="var">R</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20).<br/>
</div>

<div class="doc">
Note: we can <i>recover</i> the ordinary <span class="inlinecode"><span class="id" title="var">eqM</span></span> by instantiating <span class="inlinecode"><span class="id" title="var">R</span></span> with <span class="inlinecode">=</span> :
<br/>
<span class="inlinecode"><span class="id" title="var">eqM</span> := <span class="id" title="var">eqMR</span> <span class="id" title="var">eq</span>
</span>
<div class="paragraph"> </div>

<a id="lab309"></a><h3 class="section">Logical relation for (itree) <span class="inlinecode"><span class="id" title="var">ret</span></span></h3>

</div>

<div class="doc">
For <span class="inlinecode"><span class="id" title="var">eqM</span></span>, we didn't have to justify that <span class="inlinecode"><span class="id" title="var">ret</span></span> was <span class="inlinecode"><span class="id" title="var">Proper</span></span>. But
for this version, we have to show that it is.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqMR_Ret</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>) (<span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">RR</span> : <span class="id" title="var">relH</span> <span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span>) (<span class="id" title="var">r<sub>1</sub></span> : <span class="id" title="var">R<sub>1</sub></span>) (<span class="id" title="var">r<sub>2</sub></span> : <span class="id" title="var">R<sub>2</sub></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">RR</span> <span class="id" title="var">r<sub>1</sub></span> <span class="id" title="var">r<sub>2</sub></span> ↔ <span class="id" title="var">Ret</span> <span class="id" title="var">r<sub>1</sub></span> ≈[ <span class="id" title="var">RR</span>] <span class="id" title="var">Ret</span> <span class="id" title="var">r<sub>2</sub></span>
</span>
<div class="paragraph"> </div>

<a id="lab310"></a><h3 class="section">Logical relation for <span class="inlinecode"><span class="id" title="var">bind</span></span></h3>

</div>

<div class="doc">
The generalization of <span class="inlinecode"><span class="id" title="var">Proper</span></span> for <span class="inlinecode"><span class="id" title="var">bind</span></span> looks like this:
<br/>
<span class="inlinecode"><span class="id" title="var">eqMR_bind</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> (<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>) (<span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">RR</span> : <span class="id" title="var">relH</span> <span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span>) (<span class="id" title="var">U<sub>1</sub></span> <span class="id" title="var">U<sub>2</sub></span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">UU</span> : <span class="id" title="var">relH</span> <span class="id" title="var">U<sub>1</sub></span> <span class="id" title="var">U<sub>2</sub></span>) (<span class="id" title="var">t<sub>1</sub></span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">U<sub>1</sub></span>) (<span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">U<sub>2</sub></span>) (<span class="id" title="var">k<sub>1</sub></span> : <span class="id" title="var">U<sub>1</sub></span> → <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">R<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">k<sub>2</sub></span> : <span class="id" title="var">U<sub>2</sub></span> → <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">R<sub>2</sub></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> ≈[ <span class="id" title="var">UU</span>] <span class="id" title="var">t<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> (<span class="id" title="var">u<sub>1</sub></span> : <span class="id" title="var">U<sub>1</sub></span>) (<span class="id" title="var">u<sub>2</sub></span> : <span class="id" title="var">U<sub>2</sub></span>), <span class="id" title="var">UU</span> <span class="id" title="var">u<sub>1</sub></span> <span class="id" title="var">u<sub>2</sub></span> → <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">u<sub>1</sub></span> ≈[ <span class="id" title="var">RR</span>] <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="var">u<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">x</span> &lt;- <span class="id" title="var">t<sub>1</sub></span>;; <span class="id" title="var">k<sub>1</sub></span> <span class="id" title="var">x</span>) ≈[ <span class="id" title="var">RR</span>] (<span class="id" title="var">x</span> &lt;- <span class="id" title="var">t<sub>2</sub></span>;; <span class="id" title="var">k<sub>2</sub></span> <span class="id" title="var">x</span>)
</span>
<div class="paragraph"> </div>

<a id="lab311"></a><h3 class="section">Expected Properties Of <span class="inlinecode"><span class="id" title="var">EqMR</span></span></h3>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">EqMR</span></span>

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><span class="id" title="var">R</span></span> is a an equivalence then so is <span class="inlinecode">≈[<span class="id" title="var">RR</span>]</span>

<div class="paragraph"> </div>


</li>
<li> Monotonicity: if <span class="inlinecode"><span class="id" title="var">R<sub>1</sub></span></span> <span class="inlinecode">⊆</span> <span class="inlinecode"><span class="id" title="var">R<sub>2</sub></span></span> then <span class="inlinecode">≈[<span class="id" title="var">R<sub>1</sub></span>]</span> <span class="inlinecode">⊆</span> <span class="inlinecode">≈[<span class="id" title="var">R<sub>2</sub></span>]</span>

<div class="paragraph"> </div>


</li>
<li> General notion of the "image" of a monadic computation (useful for inversion principles).

</li>
</ul>

<div class="paragraph"> </div>

<br/>
<span class="inlinecode"><span class="id" title="keyword">Definition</span> <span class="id" title="var">imageH</span> <span class="id" title="var">m</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">R</span>, <span class="id" title="var">PER</span> <span class="id" title="var">R</span> → <span class="id" title="var">m</span> ≈[<span class="id" title="var">R</span>] <span class="id" title="var">m</span> → <span class="id" title="var">R</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">image</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> := <span class="id" title="var">imageH</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Notation</span> "a ∈ m" := (<span class="id" title="var">image</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span>)
</span>
<div class="paragraph"> </div>

<a id="lab312"></a><h3 class="section">Semantic Definition of Hoare Triples</h3>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">hoare_itree_triple</span> (<span class="id" title="var">P</span>:<span class="id" title="var">Assertion</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">Assertion</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> σ, <span class="id" title="var">P</span> σ → <span class="id" title="var">eutt</span> (<span class="id" title="keyword">fun</span> '(σ1,<span class="id" title="var">_</span>) '(σ2,<span class="id" title="var">_</span>) ⇒ σ1 = σ2 ∧ <span class="id" title="var">Q</span> σ1) (<span class="id" title="var">ℑ</span> ⟦<span class="id" title="var">c</span>⟧ σ) (<span class="id" title="var">ℑ</span> ⟦<span class="id" title="var">c</span>⟧ σ).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;⦃ P ⦄  c  ⦃ Q ⦄" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">hoare_itree_triple</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Q</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99)<br/>
&nbsp;&nbsp;: <span class="id" title="var">hoare_spec_scope</span>.<br/>
</div>

<div class="doc">
<a id="lab313"></a><h3 class="section">Proofs of Hoare Inference Rules</h3>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">skip</span> ⦃<span class="id" title="var">P</span>⦄.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">interp_state_ret</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃<span class="id" title="var">Q</span>⦄ <span class="id" title="var">c<sub>2</sub></span> ⦃<span class="id" title="var">R</span>⦄ →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c<sub>1</sub></span> ⦃<span class="id" title="var">Q</span>⦄ →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span> ⦃<span class="id" title="var">R</span>⦄.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">PRE</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_clo_bind</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>1</sub></span>, <span class="id" title="var">u<sub>2</sub></span>. <span class="id" title="tactic">intros</span> [<span class="id" title="var">MEQ</span> <span class="id" title="var">QM</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_asgn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">Q</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>]⦄ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> σ <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">norm</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
An alternative formulation that works better for forward reasoning. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_asgn'</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> ⦃ <span class="id" title="keyword">fun</span> (σ:<span class="id" title="var">mem</span>) ⇒ <span class="id" title="tactic">∃</span> σ', σ = (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (<span class="id" title="var">aeval</span> σ' <span class="id" title="var">a</span>) ; σ') ∧ <span class="id" title="var">P</span> σ' ⦄.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> σ <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> σ. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_if</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;⦃ <span class="id" title="var">P</span> ∧ <span class="id" title="var">b</span> ⦄ <span class="id" title="var">c<sub>1</sub></span> ⦃<span class="id" title="var">Q</span>⦄ →<br/>
&nbsp;&nbsp;⦃ <span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b</span>⦄ <span class="id" title="var">c<sub>2</sub></span> ⦃<span class="id" title="var">Q</span>⦄ →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ <span class="id" title="var">HS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> σ <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HB</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">HB</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_while</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span> ∧ <span class="id" title="var">b</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">P</span>⦄ →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ⦃<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b</span>⦄.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">einit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">ecofix</span> <span class="id" title="var">CIH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ <span class="id" title="var">HS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">unfold_repeat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bind_bind</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO&nbsp;SAZ:&nbsp;<span class="inlinecode"><span class="id" title="var">norm</span></span>&nbsp;loops&nbsp;here&nbsp;for&nbsp;some&nbsp;reason.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">interp_state_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">ebind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pbc_intro_h</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">RU</span> := <span class="id" title="keyword">fun</span> '(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">b<sub>1</sub></span>) '(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">b<sub>2</sub></span>) ⇒ <span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span> ∧ <span class="id" title="var">st<sub>1</sub></span> = σ ∧ <span class="id" title="var">b<sub>1</sub></span> = <span class="id" title="var">b<sub>2</sub></span> ∧ <span class="id" title="var">b<sub>1</sub></span> = <span class="id" title="var">beval</span> σ <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eqit_Ret</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>1</sub></span>, <span class="id" title="var">u<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">as</span> [? [? [? ?]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> σ <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> σ (<span class="id" title="var">conj</span> <span class="id" title="var">HS</span>  <span class="id" title="var">HB</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ebind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>1</sub></span>, <span class="id" title="var">u<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">interp_state_tau</span>. <span class="id" title="var">estep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">estep</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">HB</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_consequence_pre</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P'</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄ →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span> →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">c</span> <span class="id" title="var">Htriple</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Htriple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_consequence_conj</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄ →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q'</span>⦄ →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span> ∧ <span class="id" title="var">Q'</span>⦄.<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H<sub>1</sub></span> σ <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H<sub>2</sub></span> σ <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">eutt_conj</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eqit_mon</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x<sub>0</sub></span>, <span class="id" title="var">x<sub>1</sub></span>. <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_consequence_post</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q'</span>⦄ →<br/>
&nbsp;&nbsp;<span class="id" title="var">Q'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c</span> <span class="id" title="var">Htriple</span> <span class="id" title="var">Hpre</span> <span class="id" title="var">Hpost</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eqit_mon</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">RR</span> := (<span class="id" title="keyword">fun</span> '(σ1, <span class="id" title="var">_</span>) '(σ2, <span class="id" title="var">_</span>) ⇒ σ1 = σ2 ∧ <span class="id" title="var">Q</span> σ1) ); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x<sub>0</sub></span>, <span class="id" title="var">x<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">c</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_consequence</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P'</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q'</span>⦄ →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Q'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c</span> <span class="id" title="var">Htriple</span> <span class="id" title="var">Hpre</span> <span class="id" title="var">Hpost</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_consequence_pre</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> := <span class="id" title="var">P'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_consequence_post</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Q'</span> := <span class="id" title="var">Q'</span>); <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_post_true</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">st</span>, <span class="id" title="var">Q</span> <span class="id" title="var">st</span>) →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c</span> <span class="id" title="var">HQ</span>. <span class="id" title="var">revert</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_consequence_post</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_skip</span>. <span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_seq</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHc1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_if</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_consequence_pre</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> := <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_consequence_post</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_while</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Prove that if <span class="inlinecode"><span class="id" title="var">P</span></span> holds in no state, then any triple with <span class="inlinecode"><span class="id" title="var">P</span></span> as
    its precondition is valid. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hoare_itree_pre_false</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">st</span>, ¬(<span class="id" title="var">P</span> <span class="id" title="var">st</span>)) →<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c</span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">not</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">semantic_preservation</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> σ, <span class="id" title="var">P</span> σ → <span class="id" title="var">ℑ</span>⟦<span class="id" title="var">c<sub>1</sub></span>⟧σ ≈ <span class="id" title="var">ℑ</span>⟦<span class="id" title="var">c<sub>2</sub></span>⟧σ) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c<sub>1</sub></span> ⦃<span class="id" title="var">Q</span>⦄ →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⦃<span class="id" title="var">P</span>⦄ <span class="id" title="var">c<sub>2</sub></span> ⦃<span class="id" title="var">Q</span>⦄.<br/>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">EQ</span> <span class="id" title="var">HC<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hoare_itree_triple</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HC<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> σ <span class="id" title="var">HS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">EQ</span> σ <span class="id" title="var">HS</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">HC<sub>1</sub></span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">hoare_itree_if_example</span> :<br/>
&nbsp;&nbsp;⦃<span class="id" title="var">True</span>⦄<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> = 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Y</span> := <span class="id" title="var">X</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;⦃<span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span>⦄.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_if</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">assertion_auto'</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">hoare_itree_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_itree_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">assertion_auto'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab314"></a><h2 class="section">Substitution</h2>

</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">substitute_aexp</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">ax</span>:<span class="id" title="var">aexp</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">aexp</span>) : <span class="id" title="var">aexp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="var">String.eqb</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">ax</span> <span class="id" title="keyword">else</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> + <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) + (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> - <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) - (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> × <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) × (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">X</span> (&lt;{ <span class="id" title="var">Y</span> + 2}&gt;) (&lt;{ <span class="id" title="var">X</span> + <span class="id" title="var">Z</span> }&gt;)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">aexp_eval_semantics2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">aeval</span> σ <span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">aeval</span> σ <span class="id" title="var">a<sub>2</sub></span>) ↔<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">a<sub>1</sub></span> ⟧<span class="id" title="var">a</span> σ ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">a<sub>2</sub></span> ⟧<span class="id" title="var">a</span> σ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">aexp_equiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aexp_pure_aeval</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitute_aexp_aeval</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) <span class="id" title="var">ax</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> σ (<span class="id" title="var">EQ</span> : <span class="id" title="var">aeval</span> σ &lt;{ <span class="id" title="var">x</span> }&gt; = <span class="id" title="var">aeval</span> σ <span class="id" title="var">ax</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> σ <span class="id" title="var">a</span> = <span class="id" title="var">aeval</span> σ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a</span> σ <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">EQ</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitute_aexp_semantic</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) <span class="id" title="var">ax</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> σ (<span class="id" title="var">EQ</span>: <span class="id" title="var">ℑ</span> ⟦ &lt;{ <span class="id" title="var">x</span> }&gt; ⟧<span class="id" title="var">a</span> σ ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">ax</span> ⟧<span class="id" title="var">a</span> σ),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">a</span> ⟧<span class="id" title="var">a</span> σ ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a</span> ⟧<span class="id" title="var">a</span> σ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a</span> σ <span class="id" title="var">HEQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">aexp_eval_semantics2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">substitute_aexp_aeval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">aexp_eval_semantics2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bexp_eval_semantics</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">beval</span> σ <span class="id" title="var">b<sub>1</sub></span> = <span class="id" title="var">beval</span> σ <span class="id" title="var">b<sub>2</sub></span>) ↔<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">b<sub>1</sub></span> ⟧<span class="id" title="var">b</span> σ ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">b<sub>2</sub></span> ⟧<span class="id" title="var">b</span> σ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bexp_equiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">bexp_pure_beval</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">substitute_bexp</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">ax</span>:<span class="id" title="var">aexp</span>) (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) : <span class="id" title="var">bexp</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">true</span>}&gt;      ⇒ <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">false</span>}&gt;     ⇒ <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">a<sub>2</sub></span>}&gt;   ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) = (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> ≠ <span class="id" title="var">a<sub>2</sub></span>}&gt;   ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) ≠ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> ≤ <span class="id" title="var">a<sub>2</sub></span>}&gt;  ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) ≤ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> &gt; <span class="id" title="var">a<sub>2</sub></span>}&gt;   ⇒ &lt;{ (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>1</sub></span>) &gt; (<span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{~ <span class="id" title="var">b<sub>1</sub></span>}&gt;      ⇒ &lt;{~ (<span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b<sub>1</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">b<sub>1</sub></span> &amp;&amp; <span class="id" title="var">b<sub>2</sub></span>}&gt;  ⇒ &lt;{ (<span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b<sub>1</sub></span>) &amp;&amp; (<span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitute_bexp_beval</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) <span class="id" title="var">ax</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> σ (<span class="id" title="var">EQ</span> : <span class="id" title="var">aeval</span> σ &lt;{ <span class="id" title="var">x</span> }&gt; = <span class="id" title="var">aeval</span> σ <span class="id" title="var">ax</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> σ <span class="id" title="var">b</span> = <span class="id" title="var">beval</span> σ (<span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span> σ <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">substitute_aexp_aeval</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">substitute_aexp_aeval</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">substitute_aexp_aeval</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">substitute_aexp_aeval</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHb</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHb1</span>, <span class="id" title="var">IHb2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitute_bexp_semantic</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) <span class="id" title="var">ax</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> σ (<span class="id" title="var">EQ</span>: <span class="id" title="var">ℑ</span> ⟦ &lt;{ <span class="id" title="var">x</span> }&gt; ⟧<span class="id" title="var">a</span> σ ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">ax</span> ⟧<span class="id" title="var">a</span> σ),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">b</span> ⟧<span class="id" title="var">b</span> σ ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span> ⟧<span class="id" title="var">b</span> σ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a</span> σ <span class="id" title="var">HEQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">bexp_eval_semantics</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">substitute_bexp_beval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">aexp_eval_semantics2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">contains</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">aexp</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">String.eqb</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> + <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ (<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> || <span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span>)%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> - <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ (<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> || <span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span>)%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> × <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ (<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> || <span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span>)%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_false_equiv</span>: <span class="id" title="keyword">∀</span> (<span class="id" title="var">y</span>:<span class="id" title="var">string</span>) <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (σ:<span class="id" title="var">state</span>) <span class="id" title="var">n</span>, <span class="id" title="var">aeval</span> σ <span class="id" title="var">a</span> = <span class="id" title="var">aeval</span> ( <span class="id" title="var">y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span> ; σ ) <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">HC</span> σ <span class="id" title="var">m</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">HC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Bool.orb_false_elim</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HC</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HA<sub>1</sub></span> <span class="id" title="var">HA<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Bool.orb_false_elim</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HC</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HA<sub>1</sub></span> <span class="id" title="var">HA<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Bool.orb_false_elim</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HC</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HA<sub>1</sub></span> <span class="id" title="var">HA<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Because commands are not pure, we can't blindly substitute. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">substitute_com</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">ax</span>:<span class="id" title="var">aexp</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : (<span class="id" title="var">com</span> × <span class="id" title="var">bool</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ (<span class="id" title="var">c</span>, <span class="id" title="var">false</span>)<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">a'</span> := <span class="id" title="var">substitute_aexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">a</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a'</span> }&gt;, ((<span class="id" title="var">y</span> =? <span class="id" title="var">x</span>)%<span class="id" title="var">string</span> || <span class="id" title="var">contains</span> <span class="id" title="var">y</span> <span class="id" title="var">ax</span>)%<span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">c<sub>1</sub>'</span>, <span class="id" title="var">stop</span>) := <span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">stop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (&lt;{ <span class="id" title="var">c<sub>1</sub>'</span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt;, <span class="id" title="var">stop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">c<sub>2</sub>'</span>, <span class="id" title="var">stop</span>) := <span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;{ <span class="id" title="var">c<sub>1</sub>'</span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;, <span class="id" title="var">stop</span>)<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">c<sub>1</sub>'</span>, <span class="id" title="var">stop1</span>) := <span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">c<sub>2</sub>'</span>, <span class="id" title="var">stop2</span>) := <span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;{ <span class="id" title="keyword">if</span> (<span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub>'</span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub>'</span> <span class="id" title="keyword">end</span> }&gt;, (<span class="id" title="var">stop1</span> || <span class="id" title="var">stop2</span>)%<span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">c'</span>, <span class="id" title="var">stop</span>) := <span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">stop</span> <span class="id" title="keyword">then</span> (&lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt;, <span class="id" title="var">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> (&lt;{ <span class="id" title="var">while</span> (<span class="id" title="var">substitute_bexp</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span>) <span class="id" title="tactic">do</span> <span class="id" title="var">c'</span> <span class="id" title="keyword">end</span>}&gt;, <span class="id" title="var">false</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Examples of when it is OK (or not) to substitute: 
</div>
<div class="code">
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">substitute_com</span> <span class="id" title="var">X</span> 0 &lt;{ <span class="id" title="var">Z</span> := 3; <span class="id" title="var">Y</span> := <span class="id" title="var">X</span> + <span class="id" title="var">X</span> ; <span class="id" title="var">Y</span> := <span class="id" title="var">X</span> }&gt;.<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">substitute_com</span> <span class="id" title="var">X</span> 0 &lt;{ <span class="id" title="var">X</span> := 3; <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">X</span> ; <span class="id" title="var">Y</span> := <span class="id" title="var">X</span> }&gt;.<br/>
</div>

<div class="doc">
Define an invariant that says when we can safely substitute the
expression  &lt;{ ax }&gt; for &lt;{ x }&gt; in a state σ.  
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> σ :=<br/>
&nbsp;&nbsp;<span class="id" title="var">aeval</span> σ &lt;{ <span class="id" title="var">x</span> }&gt; = <span class="id" title="var">aeval</span> σ <span class="id" title="var">ax</span>.<br/>
</div>

<div class="doc">
Define the relational post condition for reasoning about the
results of substitution. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">post_condition</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span> (σ:<span class="id" title="var">state</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> σ1 σ2 ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;σ1 = σ2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∧ (<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → (σ1 <span class="id" title="var">x</span> = σ <span class="id" title="var">x</span> ∧ <span class="id" title="var">aeval</span> σ <span class="id" title="var">ax</span> = <span class="id" title="var">aeval</span> σ1 <span class="id" title="var">ax</span> ∧ <span class="id" title="var">subst_invariant</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> σ1)).<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">local</span>]<br/>
&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">post_condition_refl</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Reflexive</span> (<span class="id" title="var">post_condition</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">true</span> σ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">post_condition_mono</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> σ <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b<sub>1</sub></span> = <span class="id" title="var">true</span> → <span class="id" title="var">b<sub>2</sub></span> = <span class="id" title="var">true</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">post_condition</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b<sub>1</sub></span> σ <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">post_condition</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b<sub>2</sub></span> σ <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitute_com_correct1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c</span> <span class="id" title="var">c'</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">HS</span>: <span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c</span> = (<span class="id" title="var">c'</span>, <span class="id" title="var">b</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> σ (<span class="id" title="var">P</span>: <span class="id" title="var">subst_invariant</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> σ),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eutt</span> (<span class="id" title="var">prod_rel</span> (<span class="id" title="var">post_condition</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">b</span> σ) <span class="id" title="var">eq</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ℑ</span> ⟦<span class="id" title="var">c</span>⟧ σ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ℑ</span> ⟦<span class="id" title="var">c'</span>⟧ σ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HS</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">HS</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">substitute_aexp_aeval</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Bool.orb_false_l</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">t_update_neq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">contains_false_equiv</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Bool.orb_false_l</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">contains_false_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">contains_false_equiv</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">eqb_neq</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>1</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHc1</span> <span class="id" title="var">c</span> <span class="id" title="var">b<sub>0</sub></span> <span class="id" title="var">eq_refl</span> σ <span class="id" title="var">P</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">HS</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_clo_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">u<sub>1</sub></span> <span class="id" title="var">u<sub>2</sub></span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>1</sub></span>, <span class="id" title="var">u<sub>2</sub></span>, <span class="id" title="var">u</span>, <span class="id" title="var">u<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HP</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HM</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HM</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HS</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_clo_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">u<sub>1</sub></span> <span class="id" title="var">u<sub>2</sub></span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>1</sub></span>, <span class="id" title="var">u<sub>2</sub></span>, <span class="id" title="var">u</span>, <span class="id" title="var">u<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HP</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">HM</span> <span class="id" title="var">H</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HM</span> <span class="id" title="var">HE</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HE</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HE</span> <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHc2</span> <span class="id" title="var">c<sub>0</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">eq_refl</span> <span class="id" title="var">m<sub>0</sub></span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_subrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc2</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>, <span class="id" title="var">u</span>, <span class="id" title="var">b<sub>0</sub></span>, <span class="id" title="var">u</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>1</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HS</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">substitute_bexp_beval</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> σ <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_subrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc1</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">post_condition_mono</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_subrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc2</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">post_condition_mono</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">HS</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">HS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">HS</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHc</span> <span class="id" title="var">c<sub>0</sub></span> <span class="id" title="var">false</span> <span class="id" title="var">eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_subrel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_interp_state_iter</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">RS</span> := <span class="id" title="var">post_condition</span> <span class="id" title="var">x</span> <span class="id" title="var">ax</span> <span class="id" title="var">false</span> σ)(<span class="id" title="var">RA</span> := <span class="id" title="var">eq</span>)(<span class="id" title="var">RB</span> := <span class="id" title="var">eq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">substitute_bexp_beval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_clo_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHc</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">norm</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>1</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">u<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prod_morphism</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fst_rel</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">snd_rel</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prod_morphism</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>3</sub></span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>, <span class="id" title="var">b<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prod_morphism</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">com_append</span> (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>11</sub></span> ; <span class="id" title="var">c<sub>12</sub></span>}&gt; ⇒ &lt;{ <span class="id" title="var">c<sub>11</sub></span> ; (<span class="id" title="var">com_append</span> <span class="id" title="var">c<sub>12</sub></span> <span class="id" title="var">c<sub>2</sub></span>) }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;TODO:&nbsp;This&nbsp;proof&nbsp;can&nbsp;be&nbsp;cleaned&nbsp;up&nbsp;using&nbsp;ImpEquiv&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">com_append_correct</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">com_append</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ≡ &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">c<sub>2</sub></span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">skipL_sound</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">seqA_sound</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc1_2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">global</span>]<br/>
&nbsp;<span class="id" title="keyword">Instance</span> <span class="id" title="var">Proper_com_append</span>: <span class="id" title="var">Proper</span> (<span class="id" title="var">com_eq</span> ==&gt; <span class="id" title="var">com_eq</span> ==&gt; <span class="id" title="var">com_eq</span>) <span class="id" title="var">com_append</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c<sub>11</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c<sub>11</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">c<sub>12</sub></span> <span class="id" title="var">EQ<sub>1</sub></span> <span class="id" title="var">c<sub>21</sub></span> <span class="id" title="var">c<sub>22</sub></span> <span class="id" title="var">EQ<sub>2</sub></span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">skipL_sound</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">seqA_sound</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">com_assocR</span> <span class="id" title="var">c</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">com_assocR</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">com_assocR</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">com_append</span> <span class="id" title="var">c<sub>1</sub>'</span> <span class="id" title="var">c<sub>2</sub>'</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">com_assocR</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">com_assocR</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub>'</span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub>'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c'</span> := <span class="id" title="var">com_assocR</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">com_assocR_correct</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> ≡ <span class="id" title="var">com_assocR</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">com_append_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">propagate_com</span> (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">propagate_com</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">contains</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span>;  <span class="id" title="var">fst</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> <span class="id" title="var">c<sub>2</sub>'</span>) }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">propagate_com</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">propagate_com</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">c<sub>1</sub>'</span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">propagate_com</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">propagate_com</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span>  <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub>'</span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub>'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c'</span> := <span class="id" title="var">propagate_com</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">subst_invariant_good</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) <span class="id" title="var">a</span> σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">subst_invariant</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">aeval</span> σ <span class="id" title="var">a</span>; σ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">subst_invariant</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">contains_false_equiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitute_com_subst</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">c</span> ⟧ (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">aeval</span> σ <span class="id" title="var">a</span>; σ) ≈ <span class="id" title="var">ℑ</span> ⟦ <span class="id" title="var">fst</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">c</span>) ⟧ (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">aeval</span> σ <span class="id" title="var">a</span>; σ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">substitute_com</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">c</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">substitute_com_correct1</span> <span class="id" title="keyword">with</span> (σ := (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">aeval</span> σ <span class="id" title="var">a</span>; σ)) <span class="id" title="keyword">in</span> <span class="id" title="var">HS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_subrel</span>.<br/>
&nbsp;&nbsp;2: { <span class="id" title="tactic">apply</span> <span class="id" title="var">HS</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a<sub>0</sub></span>, <span class="id" title="var">u</span>, <span class="id" title="var">b<sub>0</sub></span>, <span class="id" title="var">u</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">post_condition</span> <span class="id" title="keyword">in</span> <span class="id" title="var">fst_rel</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">subst_invariant_good</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">propagate_com_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> ≊ (<span class="id" title="var">propagate_com</span> <span class="id" title="var">c</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="tactic">transitivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">substitute_com_subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">example</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := 4 + 5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ((<span class="id" title="var">X</span> - <span class="id" title="var">Y</span>) = (2 + 4)) <span class="id" title="keyword">then</span> <span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Y</span> := <span class="id" title="var">X</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (0 ≤ (4 - (2 + 1))) <span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> (<span class="id" title="var">Y</span> = 0) <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">fold_constants_com</span> (<span class="id" title="var">propagate_com</span> <span class="id" title="var">example</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">correct</span>: <span class="id" title="var">example</span> ≊ (<span class="id" title="var">fold_constants_com</span> (<span class="id" title="var">propagate_com</span> <span class="id" title="var">example</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">fold_constants_com_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">propagate_com_sound</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">loop_unroll_while</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> ⇒ &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span> ; (<span class="id" title="var">loop_unroll_while</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">loop_unroll_sound</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ≡ <span class="id" title="var">loop_unroll_while</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">loop_unroll1_sound_strong</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">c<sub>1</sub>'</span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span>  <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub>'</span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub>'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">loop_unroll_while</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">loop_unroll_com_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> ≊ (<span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">com_equiv</span>. <span class="id" title="tactic">intros</span> σ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">com_eq_subrel_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">loop_unroll_sound</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">iterate_opt</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">opt</span> : <span class="id" title="var">com</span> → <span class="id" title="var">com</span>) <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">iterate_opt</span> <span class="id" title="var">n</span> <span class="id" title="var">opt</span> (<span class="id" title="var">opt</span> <span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">iterate_opt_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> (<span class="id" title="var">opt</span> : <span class="id" title="var">com</span> → <span class="id" title="var">com</span>)  (<span class="id" title="var">OPTSOUND</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span>, <span class="id" title="var">c</span> ≊ <span class="id" title="var">opt</span> <span class="id" title="var">c</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> ≊ <span class="id" title="var">iterate_opt</span> <span class="id" title="var">n</span> <span class="id" title="var">opt</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">opt</span> <span class="id" title="var">OPTSOUND</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">OPTSOUND</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">optimize</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c'</span> := <span class="id" title="var">com_assocR</span> (<span class="id" title="var">loop_unroll_com</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">iterate_opt</span> <span class="id" title="var">n</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">fold_constants_com</span> (<span class="id" title="var">propagate_com</span> <span class="id" title="var">c</span>)) <span class="id" title="var">c'</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">optimize_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> ≊ <span class="id" title="var">optimize</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">optimize</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">iterate_opt_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">com_assocR_correct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">loop_unroll_com_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c<sub>0</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">fold_constants_com_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">propagate_com_sound</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Imp code for <span class="inlinecode"><span class="id" title="var">factorial</span></span> for a specific number: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fact_n</span> <span class="id" title="var">n</span> := &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">n</span> ; <span class="id" title="var">fact_in_coq</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fact_opt</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">optimize</span> (<span class="id" title="var">n</span>+1) (<span class="id" title="var">fact_n</span> <span class="id" title="var">n</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fact_opt8</span> := <span class="id" title="var">fact_opt</span> 8.<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">com_assocR</span> <span class="id" title="var">fact_opt8</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fact_opt5</span> := <span class="id" title="var">fact_opt</span> 5.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">fact_n</span> 5.<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">fact_opt5</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fact_opt_correct</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">n</span> ; <span class="id" title="var">fact_in_coq</span> }&gt; ≊ <span class="id" title="var">fact_opt</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fact_in_coq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">optimize_sound</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">store_store_elimination_correct</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span> = <span class="id" title="var">false</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">x</span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">x</span> := <span class="id" title="var">a<sub>2</sub></span> }&gt; ≊ &lt;{ <span class="id" title="var">x</span> := <span class="id" title="var">a<sub>2</sub></span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">H</span> σ.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contains_false_equiv</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">asgn_commutes</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span>:<span class="id" title="var">string</span>) <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">contains</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span> = <span class="id" title="var">false</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">contains</span> <span class="id" title="var">y</span> <span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">false</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> ≠ <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">x</span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">y</span> := <span class="id" title="var">a<sub>2</sub></span> }&gt; ≊ &lt;{ <span class="id" title="var">y</span> := <span class="id" title="var">a<sub>2</sub></span>; <span class="id" title="var">x</span> := <span class="id" title="var">a<sub>1</sub></span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">C<sub>1</sub></span> <span class="id" title="var">C<sub>2</sub></span> <span class="id" title="var">NEQ</span> σ.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contains_false_equiv</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">C<sub>1</sub></span>) <span class="id" title="keyword">as</span> <span class="id" title="var">EQ<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contains_false_equiv</span> <span class="id" title="var">y</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">C<sub>2</sub></span>) <span class="id" title="keyword">as</span> <span class="id" title="var">EQ<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> <span class="id" title="var">fact_opt5</span>.<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

x1 = a<sub>1</sub> ; x<sub>2</sub> = a<sub>2</sub> ; x<sub>3</sub> = a<sub>3</sub> ; c
x1 = x<sub>3</sub>
x1 = a<sub>1</sub> ; x<sub>2</sub> = a<sub>2</sub> ; x<sub>1</sub> = a<sub>3</sub> ; c   // x<sub>1</sub> &lt;&gt; x<sub>2</sub> /\ not (contains x<sub>1</sub> a<sub>2</sub>)  /\ not (contains x<sub>2</sub> a<sub>3</sub>)
x1 = a<sub>1</sub> ; x<sub>1</sub> = a<sub>3</sub> ; x<sub>2</sub> = a<sub>2</sub> ; c
x1 = a<sub>3</sub> ; x<sub>2</sub> = a<sub>2</sub> ; c             // not contains x<sub>1</sub> a<sub>3</sub>

</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">dead_store_elimination</span> (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x</span> := <span class="id" title="var">a</span> }&gt; ⇒ <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c<sub>2</sub>'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ((<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>))%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">x<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> ; <span class="id" title="var">c<sub>3</sub>'</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c<sub>3</sub>'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x<sub>3</sub></span> := <span class="id" title="var">a<sub>3</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>3</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="var">x<sub>3</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>3</sub></span> <span class="id" title="var">a<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="var">a<sub>3</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>3</sub></span>))%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> &lt;{ <span class="id" title="var">x<sub>3</sub></span> := <span class="id" title="var">a<sub>3</sub></span> ; <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> &lt;{ <span class="id" title="var">x<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x<sub>3</sub></span> := <span class="id" title="var">a<sub>3</sub></span> ; <span class="id" title="var">c<sub>4</sub>'</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>3</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;  <span class="id" title="var">negb</span> (<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="var">x<sub>3</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>3</sub></span> <span class="id" title="var">a<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="var">a<sub>3</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>3</sub></span>))%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> &lt;{ <span class="id" title="var">x<sub>3</sub></span> := <span class="id" title="var">a<sub>3</sub></span> ; <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> ; <span class="id" title="var">c<sub>4</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> ((<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>2</sub></span> <span class="id" title="var">x<sub>3</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>))%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> &lt;{ <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> ; <span class="id" title="var">x<sub>3</sub></span> := <span class="id" title="var">a<sub>3</sub></span> ; <span class="id" title="var">c<sub>4</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> &lt;{ <span class="id" title="var">x<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ((<span class="id" title="var">String.eqb</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">negb</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>))%<span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">x<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span> ; <span class="id" title="var">c<sub>3</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">x<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ &lt;{ <span class="id" title="var">x<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>1</sub>'</span> := <span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c<sub>2</sub>'</span> := <span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span>  <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub>'</span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub>'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c'</span> := <span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c'</span> <span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> (<span class="id" title="var">dead_store_elimination</span> &lt;{ <span class="id" title="var">X</span> := 0 ; <span class="id" title="var">Y</span> := 1 ; <span class="id" title="var">Y</span> := 2 ; <span class="id" title="var">skip</span> }&gt;).<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> (<span class="id" title="var">dead_store_elimination</span> (<span class="id" title="var">com_assocR</span> <span class="id" title="var">fact_opt5</span>)).<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> (<span class="id" title="var">dead_store_elimination</span> &lt;{ <span class="id" title="var">Y</span> := 120; <span class="id" title="var">Z</span> := 0; <span class="id" title="var">skip</span> }&gt;).<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="keyword">in</span> (<span class="id" title="var">dead_store_elimination</span> &lt;{ <span class="id" title="var">Y</span>:= 0; <span class="id" title="var">Y</span> := 120; <span class="id" title="var">Z</span> := 0; <span class="id" title="var">skip</span> }&gt;).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">dead_store_elimination_correct</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> ≊ (<span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">dead_store_elimination</span> <span class="id" title="var">c<sub>2</sub></span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>1</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">x<sub>1</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>1</sub></span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>1</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>2</sub></span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>1</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>3</sub></span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">asgn_commutes</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> <span class="id" title="var">c3_1</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>1</sub></span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 : { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>1</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: { <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">x<sub>1</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>1</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="var">contradiction</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>1</sub></span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>1</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">a<sub>1</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>1</sub></span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span> <span class="id" title="keyword">in</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">asgn_commutes</span> <span class="id" title="keyword">in</span> <span class="id" title="var">IHc2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">seqA_sound</span> <span class="id" title="keyword">in</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: { <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">x<sub>1</sub></span>); <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">x<sub>0</sub></span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">contains</span> <span class="id" title="var">x<sub>0</sub></span> <span class="id" title="var">a<sub>0</sub></span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">HC</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">seqA_sound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">store_store_elimination_correct</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc1</span>, &lt;- <span class="id" title="var">IHc2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">opt_fact_sound</span> :<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := 5;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Z</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> × <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;≊<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := 5; <span class="id" title="var">Z</span> := 0; <span class="id" title="var">Y</span> := 120 }&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">optimize_sound</span> 6).<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">dead_store_elimination_correct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">skipR_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>