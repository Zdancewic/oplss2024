<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Utils</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/rip.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Reasoning about Interactive Programs</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Utils</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">String</span> <span class="id" title="var">RelationClasses</span> <span class="id" title="var">Morphisms</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ITree</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ITree</span> <span class="id" title="var">ITreeFacts</span> <span class="id" title="var">Events.State</span> <span class="id" title="var">Events.StateFacts</span> <span class="id" title="var">HeterogeneousRelations</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ITreeNotations</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Variant</span> <span class="id" title="var">void</span> : <span class="id" title="keyword">Type</span> :=.<br/>
<span class="id" title="keyword">Variant</span> <span class="id" title="var">voidE</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span> :=.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;'pred' A" := (<span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span>)     (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>
<span class="id" title="keyword">Notation</span> &quot;'rel' A"  := (<span class="id" title="var">A</span> → <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>
<span class="id" title="keyword">Notation</span> &quot;'relH' A B"  := (<span class="id" title="var">A</span> → <span class="id" title="var">B</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>
</div>

<div class="doc">
Utilities to reason equationally 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="tactic">cut</span> := <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_eq_bind</span>; <span class="id" title="tactic">intros</span> ?.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">ecut</span> := <span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_clo_bind</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "cut" "with" <span class="id" title="var">uconstr</span>(<span class="id" title="var">x</span>) := <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_clo_bind</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">UU</span> := <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">break</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">b</span> : <span class="id" title="var">bool</span> &#x22A2; <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span> : <span class="id" title="var">unit</span> &#x22A2; <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">p</span> : <span class="id" title="var">_</span> × <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">p</span> : <span class="id" title="var">_</span> + <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">ret</span> := <span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_Ret</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">break_match</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> &#x22A2; <span class="id" title="keyword">context</span>[<span class="id" title="keyword">match</span> ?<span class="id" title="var">x</span> <span class="id" title="keyword">with</span> | <span class="id" title="var">_</span> ⇒ <span class="id" title="var">_</span> <span class="id" title="keyword">end</span>] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span> <span class="id" title="var">eqn</span>:?<span class="id" title="var">EQ</span> <span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> @<span class="id" title="var">interp_state_bind</span> @<span class="id" title="var">interp_state_trigger</span> @<span class="id" title="var">interp_state_ret</span> @<span class="id" title="var">bind_ret_l</span> @<span class="id" title="var">bind_bind</span> : <span class="id" title="var">opt</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">norm</span> := <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">opt</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Imperative&nbsp;loops&nbsp;are&nbsp;particular&nbsp;pattens&nbsp;of&nbsp;recursion:&nbsp;they&nbsp;do&nbsp;not&nbsp;carry&nbsp;any&nbsp;notion&nbsp;of&nbsp;accumulator.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;can&nbsp;capture&nbsp;this&nbsp;pattern&nbsp;with&nbsp;a&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span>&nbsp;combinator.<br/>
*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="tactic">repeat</span> {<span class="id" title="var">E</span>} (<span class="id" title="var">step</span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> (<span class="id" title="var">unit</span> + <span class="id" title="var">unit</span>)) : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ITree.iter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">step</span>) <span class="id" title="var">tt</span>.<br/>
</div>

<div class="doc">
Necessary generic material about <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> 
</div>
<div class="code">
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">eutt_repeat</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">eutt</span> <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">eutt</span> <span class="id" title="var">eq</span>) (@<span class="id" title="tactic">repeat</span> <span class="id" title="var">E</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="tactic">repeat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_iter</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> ?.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unfold_repeat</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} (<span class="id" title="var">step</span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> (<span class="id" title="var">unit</span> + <span class="id" title="var">unit</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">step</span> ≅<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flag</span> &lt;- <span class="id" title="var">step</span>;; <span class="id" title="keyword">match</span> <span class="id" title="var">flag</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inl</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">Tau</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">step</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">Ret</span> <span class="id" title="var">tt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="tactic">repeat</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">unfold_iter</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eq_itree_clo_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">break</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;TODO:&nbsp;define&nbsp;a&nbsp;generic&nbsp;<span class="inlinecode"><span class="id" title="tactic">repeat</span></span>&nbsp;for&nbsp;iterative&nbsp;monads&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">repeat_state</span> {<span class="id" title="var">E</span> <span class="id" title="var">S</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="var">Monads.stateT</span> <span class="id" title="var">S</span> (<span class="id" title="var">itree</span> <span class="id" title="var">E</span>) (<span class="id" title="var">unit</span> + <span class="id" title="var">unit</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Monads.stateT</span> <span class="id" title="var">S</span> (<span class="id" title="var">itree</span> <span class="id" title="var">E</span>) <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">step</span> ⇒ <span class="id" title="var">Basics.iter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">step</span>) <span class="id" title="var">tt</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unfold_repeat_state</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} {<span class="id" title="var">S</span>} (<span class="id" title="var">step</span> : <span class="id" title="var">Monads.stateT</span> <span class="id" title="var">S</span> (<span class="id" title="var">itree</span> <span class="id" title="var">E</span>) (<span class="id" title="var">unit</span> + <span class="id" title="var">unit</span>)) σ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">repeat_state</span> <span class="id" title="var">step</span> σ ≅<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">flag</span> &lt;- <span class="id" title="var">step</span> σ;; <span class="id" title="keyword">match</span> <span class="id" title="var">flag</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (σ, <span class="id" title="var">inl</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="var">Tau</span> (<span class="id" title="var">repeat_state</span> <span class="id" title="var">step</span> σ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (σ, <span class="id" title="var">inr</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="var">Ret</span> (σ, <span class="id" title="var">tt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">repeat_state</span>, <span class="id" title="var">Basics.iter</span>, <span class="id" title="var">MonadIter_stateT0</span>, <span class="id" title="var">Basics.iter</span>, <span class="id" title="var">MonadIter_itree</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">unfold_iter</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">bind_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eq_itree_clo_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? &lt;-.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">bind_ret_l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">break</span>; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">eq_itree_repeat_state</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} {<span class="id" title="var">S</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">pointwise_relation</span> <span class="id" title="var">_</span> (<span class="id" title="var">eq_itree</span> <span class="id" title="var">eq</span>) ==&gt; <span class="id" title="var">pointwise_relation</span> <span class="id" title="var">_</span> (<span class="id" title="var">eq_itree</span> <span class="id" title="var">eq</span>)) (@<span class="id" title="var">repeat_state</span> <span class="id" title="var">E</span> <span class="id" title="var">S</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">EQ</span> σ.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eq_itree_iter</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [? []] [? []] <span class="id" title="var">eq</span>; <span class="id" title="var">inv</span> <span class="id" title="var">eq</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eq_itree_clo_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [? ?] ? &lt;-; <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">eutt_repeat_state</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} {<span class="id" title="var">S</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="var">Proper</span> (<span class="id" title="var">pointwise_relation</span> <span class="id" title="var">_</span> (<span class="id" title="var">eutt</span> <span class="id" title="var">eq</span>) ==&gt; <span class="id" title="var">pointwise_relation</span> <span class="id" title="var">_</span> (<span class="id" title="var">eutt</span> <span class="id" title="var">eq</span>)) (@<span class="id" title="var">repeat_state</span> <span class="id" title="var">E</span> <span class="id" title="var">S</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">EQ</span> σ.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eutt_iter</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [? []]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_clo_bind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">break</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eutt_repeat_state_gen</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} {<span class="id" title="var">S</span>: <span class="id" title="keyword">Type</span>} (<span class="id" title="var">RS</span> : <span class="id" title="var">rel</span> <span class="id" title="var">S</span>):<br/>
&nbsp;&nbsp;<span class="id" title="var">Proper</span> ((<span class="id" title="var">RS</span> ==&gt; (<span class="id" title="var">eutt</span> (<span class="id" title="var">prod_rel</span> <span class="id" title="var">RS</span> <span class="id" title="var">eq</span>))) ==&gt; (<span class="id" title="var">RS</span> ==&gt; (<span class="id" title="var">eutt</span> (<span class="id" title="var">prod_rel</span> <span class="id" title="var">RS</span> <span class="id" title="var">eq</span>)))) (@<span class="id" title="var">repeat_state</span> <span class="id" title="var">E</span> <span class="id" title="var">S</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? ? ?.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (@<span class="id" title="var">eutt_iter_gen</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">prod_rel</span> <span class="id" title="var">RS</span> <span class="id" title="var">eq</span>)).<br/>
&nbsp;&nbsp;2:<span class="id" title="tactic">constructor</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="var">ecut</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [] [] []; <span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">ret</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">s<sub>4</sub></span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Variant</span> <span class="id" title="var">prod_sum_rel</span> {<span class="id" title="var">S</span>} (<span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span> : <span class="id" title="var">rel</span> <span class="id" title="var">S</span>) : <span class="id" title="var">rel</span> (<span class="id" title="var">S</span> × (<span class="id" title="var">unit</span> + <span class="id" title="var">unit</span>)) :=<br/>
| <span class="id" title="var">prod_sum_rel_left</span>  σ σ' : <span class="id" title="var">R<sub>1</sub></span> σ σ' → <span class="id" title="var">prod_sum_rel</span> <span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span> (σ, <span class="id" title="var">inl</span> <span class="id" title="var">tt</span>) (σ', <span class="id" title="var">inl</span> <span class="id" title="var">tt</span>)<br/>
| <span class="id" title="var">prod_sum_rel_right</span> σ σ' : <span class="id" title="var">R<sub>2</sub></span> σ σ' → <span class="id" title="var">prod_sum_rel</span> <span class="id" title="var">R<sub>1</sub></span> <span class="id" title="var">R<sub>2</sub></span> (σ, <span class="id" title="var">inr</span> <span class="id" title="var">tt</span>) (σ', <span class="id" title="var">inr</span> <span class="id" title="var">tt</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eutt_repeat_state'</span> {<span class="id" title="var">E</span> <span class="id" title="var">S</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">RI</span> : <span class="id" title="var">S</span> → <span class="id" title="var">S</span> → <span class="id" title="keyword">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">RR</span> : <span class="id" title="var">S</span> → <span class="id" title="var">S</span> → <span class="id" title="keyword">Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">body1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">body2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eutt_body</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">RI</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> → <span class="id" title="var">eutt</span> (<span class="id" title="var">prod_sum_rel</span> <span class="id" title="var">RI</span> <span class="id" title="var">RR</span>) (<span class="id" title="var">body1</span> <span class="id" title="var">s<sub>1</sub></span>) (<span class="id" title="var">body2</span> <span class="id" title="var">s<sub>2</sub></span>))<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> (<span class="id" title="var">RI_i</span> : <span class="id" title="var">RI</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eutt</span> (<span class="id" title="var">prod_rel</span> <span class="id" title="var">RR</span> <span class="id" title="var">eq</span>) (@<span class="id" title="var">repeat_state</span> <span class="id" title="var">E</span> <span class="id" title="var">S</span> <span class="id" title="var">body1</span> <span class="id" title="var">s<sub>1</sub></span>) (<span class="id" title="var">repeat_state</span> <span class="id" title="var">body2</span> <span class="id" title="var">s<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">einit</span>. <span class="id" title="var">ecofix</span> <span class="id" title="var">CIH</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">eutt_body</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">RI_i</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">unfold_repeat_state</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">ebind</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">paco</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [] [] ?.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">etau</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">paco</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Annoyingly&nbsp;enough,&nbsp;we&nbsp;cannot&nbsp;leverage&nbsp;<span class="inlinecode"><span class="id" title="var">eutt_iter_gen</span></span>&nbsp;to&nbsp;derive&nbsp;this&nbsp;schema:&nbsp;we&nbsp;return&nbsp;a&nbsp;prod&nbsp;of&nbsp;a&nbsp;sum,&nbsp;and&nbsp;not&nbsp;a&nbsp;sum&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eutt_repeat_state_gen'</span> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Type</span> → <span class="id" title="keyword">Type</span>} {<span class="id" title="var">S</span>: <span class="id" title="keyword">Type</span>} (<span class="id" title="var">RI</span> <span class="id" title="var">RS</span> : <span class="id" title="var">rel</span> <span class="id" title="var">S</span>):<br/>
&nbsp;&nbsp;<span class="id" title="var">Proper</span> ((<span class="id" title="var">RI</span> ==&gt; (<span class="id" title="var">eutt</span> (<span class="id" title="var">prod_sum_rel</span> <span class="id" title="var">RI</span> <span class="id" title="var">RS</span>))) ==&gt; (<span class="id" title="var">RI</span> ==&gt; (<span class="id" title="var">eutt</span> (<span class="id" title="var">prod_rel</span> <span class="id" title="var">RS</span> <span class="id" title="var">eq</span>)))) (@<span class="id" title="var">repeat_state</span> <span class="id" title="var">E</span> <span class="id" title="var">S</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? ? ?.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_repeat_state'</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interp_state_repeat</span> {<span class="id" title="var">E</span> <span class="id" title="var">F</span> <span class="id" title="var">S</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">E</span> <span class="id" title="var">T</span> → <span class="id" title="var">Monads.stateT</span> <span class="id" title="var">S</span> (<span class="id" title="var">itree</span> <span class="id" title="var">F</span>) <span class="id" title="var">T</span>) σ<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">interp_state</span> <span class="id" title="var">h</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">t</span>) σ ≅<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">repeat_state</span> (<span class="id" title="var">interp_state</span> <span class="id" title="var">h</span> <span class="id" title="var">t</span>) σ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="tactic">repeat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">interp_state_iter'</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> : <span class="id" title="var">unit</span> ⇒ <span class="id" title="var">t</span>) <span class="id" title="var">tt</span> σ).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Ok&nbsp;the&nbsp;next&nbsp;section&nbsp;is&nbsp;a&nbsp;completely&nbsp;irrelevant&nbsp;tangent,<br/>
&nbsp;&nbsp;&nbsp;but&nbsp;expressing&nbsp;the&nbsp;purity&nbsp;of&nbsp;expressions&nbsp;made&nbsp;me&nbsp;wonder:<br/>
&nbsp;&nbsp;&nbsp;if&nbsp;I&nbsp;work&nbsp;with&nbsp;<span class="inlinecode"><span class="id" title="var">void1</span></span>,&nbsp;I&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;prove&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">;;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">≈</span> <span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;without&nbsp;knowing&nbsp;whether&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;diverges&nbsp;or&nbsp;not.<br/>
&nbsp;&nbsp;&nbsp;But&nbsp;how&nbsp;do&nbsp;I&nbsp;prove&nbsp;it?&nbsp;Here's&nbsp;the&nbsp;simplest&nbsp;I&nbsp;found.<br/>
&nbsp;*)</span><br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ITree</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Props.HasPost</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">HasPostNotations</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Tangent</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <span class="id" title="var">subtree</span> {<span class="id" title="var">E</span> <span class="id" title="var">X</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">X</span>) : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">sub_refl</span>  <span class="id" title="var">v</span> : <span class="id" title="var">v</span> ≅ <span class="id" title="var">t</span> → <span class="id" title="var">subtree</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">sub_tau</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> : <span class="id" title="var">v</span> ≅ <span class="id" title="var">Tau</span> <span class="id" title="var">u</span> → <span class="id" title="var">subtree</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> → <span class="id" title="var">subtree</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">sub_vis</span> <span class="id" title="var">Y</span> (<span class="id" title="var">e</span> : <span class="id" title="var">E</span> <span class="id" title="var">Y</span>) <span class="id" title="var">y</span> <span class="id" title="var">k</span> <span class="id" title="var">v</span> : <span class="id" title="var">v</span> ≅ <span class="id" title="var">Vis</span> <span class="id" title="var">e</span> <span class="id" title="var">k</span> → <span class="id" title="var">subtree</span> <span class="id" title="var">t</span> (<span class="id" title="var">k</span> <span class="id" title="var">y</span>) → <span class="id" title="var">subtree</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;⊑" := <span class="id" title="var">subtree</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">eq_itree_subtree</span> {<span class="id" title="var">E</span> <span class="id" title="var">X</span>} : <span class="id" title="var">Proper</span> (<span class="id" title="var">eq_itree</span> <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">eq_itree</span> <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">iff</span>) (@<span class="id" title="var">subtree</span> <span class="id" title="var">E</span> <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">eqt</span> <span class="id" title="var">u</span> <span class="id" title="var">u'</span> <span class="id" title="var">equ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">revert</span> <span class="id" title="var">u'</span> <span class="id" title="var">equ</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">sub</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">sub_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">equ</span>, <span class="id" title="var">H</span>, <span class="id" title="var">eqt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_tau</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id" title="tactic">apply</span> <span class="id" title="var">IHsub</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">equ</span>, <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_vis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id" title="tactic">apply</span> <span class="id" title="var">IHsub</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">equ</span>, <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">revert</span> <span class="id" title="var">u</span> <span class="id" title="var">equ</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">sub</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">sub_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">equ</span>, <span class="id" title="var">H</span>, <span class="id" title="var">eqt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_tau</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id" title="tactic">apply</span> <span class="id" title="var">IHsub</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">equ</span>, <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_vis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id" title="tactic">apply</span> <span class="id" title="var">IHsub</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">equ</span>, <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">equiv_subtree</span> {<span class="id" title="var">E</span> <span class="id" title="var">X</span>} : <span class="id" title="var">PreOrder</span> (@<span class="id" title="var">subtree</span> <span class="id" title="var">E</span> <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">sub_refl</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">sub1</span> <span class="id" title="var">sub2</span>; <span class="id" title="var">revert</span> <span class="id" title="var">t</span> <span class="id" title="var">sub1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">sub2</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">sub1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_tau</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id" title="tactic">apply</span> <span class="id" title="var">IHsub2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_vis</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: <span class="id" title="tactic">apply</span> <span class="id" title="var">IHsub2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tau_subtree</span> {<span class="id" title="var">E</span> <span class="id" title="var">X</span>} : <span class="id" title="keyword">∀</span> (<span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">itree</span> <span class="id" title="var">E</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Tau</span> <span class="id" title="var">t</span> ⊑ <span class="id" title="var">u</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> ⊑ <span class="id" title="var">u</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_tau</span>; [<span class="id" title="tactic">reflexivity</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">sub_refl</span>; <span class="id" title="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_tau</span>; [<span class="id" title="tactic">reflexivity</span> | <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">sub_vis</span>; [<span class="id" title="tactic">reflexivity</span> | <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pure_div_or_ret_aux</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">itree</span> <span class="id" title="var">void1</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> ⊑ <span class="id" title="var">u</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> ⤳ <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">u</span> ≈ <span class="id" title="var">Ret</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>; <span class="id" title="var">revert</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">einit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ecofix</span> <span class="id" title="var">CIH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> × <span class="id" title="var">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">itree_eta</span> <span class="id" title="var">t</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">sub</span> &#x22A2; ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">desobs</span> <span class="id" title="var">t</span> <span class="id" title="var">EQu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">estep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> - <span class="id" title="var">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>, <span class="id" title="var">IHsub</span>, <span class="id" title="var">tau_eutt</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">estep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ebase</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">CIHL</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">tau_subtree</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pure_div_or_ret</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">itree</span> <span class="id" title="var">void1</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> ⤳ <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">t</span> ≈ <span class="id" title="var">Ret</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pure_div_or_ret_aux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">twice_twice_almost_pure</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">itree</span> <span class="id" title="var">void1</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> ;; <span class="id" title="var">t</span> ≈ <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">bind_ret_r</span> <span class="id" title="var">t</span>) <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eutt_post_bind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pure_div_or_ret</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pure_div_or_ret</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ?? &lt;- <span class="id" title="var">H</span> <span class="id" title="var">_</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Tangent</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>